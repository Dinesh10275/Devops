<?xml version="1.0" encoding="UTF-8"?>
<Server port="8005" shutdown="SHUTDOWN">
    <Listener className="org.apache.catalina.startup.VersionLoggerListener" />
    
    <!-- Define the Cluster -->
    <Cluster className="org.apache.catalina.ha.tcp.SimpleTcpCluster">
        <!-- Manager for Session Replication -->
        <Manager className="org.apache.catalina.ha.session.DeltaManager"
            expireSessionsOnShutdown="false"
            notifyListenersOnReplication="true"/>
        <!-- Channel for Communication -->
        <Channel className="org.apache.catalina.tribes.group.GroupChannel">
            <Membership className="org.apache.catalina.tribes.membership.McastService"
                address="228.0.0.4"
                port="45564"
                frequency="500"
                dropTime="3000"/>
            <Sender className="org.apache.catalina.tribes.transport.ReplicationTransmitter">
                <Transport className="org.apache.catalina.tribes.transport.nio.PooledParallelSender"/>
            </Sender>
            <Receiver className="org.apache.catalina.tribes.transport.nio.NioReceiver"
                address="auto"
                port="4000"
                autoBind="100"
                selectorTimeout="5000"
                maxThreads="6"/>
            <Interceptor className="org.apache.catalina.tribes.group.interceptors.TcpFailureDetector"/>
            <Interceptor className="org.apache.catalina.tribes.group.interceptors.MessageDispatch15Interceptor"/>
        </Channel>
        <!-- Replication Valve -->
        <Valve className="org.apache.catalina.ha.tcp.ReplicationValve" filter=""/>
        <!-- JVM Route Valve -->
        <Valve className="org.apache.catalina.ha.session.JvmRouteBinderValve"/>
        <!-- Cluster Listeners -->
        <ClusterListener className="org.apache.catalina.ha.session.JvmRouteSessionIDBinderListener"/>
        <ClusterListener className="org.apache.catalina.ha.session.ClusterSessionListener"/>
    </Cluster>

    <!-- Define the Engine -->
    <Engine name="Catalina" defaultHost="localhost">
        <!-- Add Valve for Session Replication -->
        <Valve className="org.apache.catalina.ha.tcp.ReplicationValve" filter=""/>
        <!-- Use the LockOutRealm to prevent attempts to guess user passwords -->
        <Realm className="org.apache.catalina.realm.LockOutRealm">
            <!-- This Realm uses the UserDatabase configured in the global JNDI -->
            <Realm className="org.apache.catalina.realm.UserDatabaseRealm"
                resourceName="UserDatabase"/>
        </Realm>
        
        <!-- Define the Host -->
        <Host name="localhost" appBase="webapps"
            unpackWARs="true" autoDeploy="true">
            <!-- Access log processes all example -->
            <Valve className="org.apache.catalina.valves.AccessLogValve"
                directory="logs" prefix="localhost_access_log" suffix=".txt"
                pattern="%h %l %u %t &quot;%r&quot; %s %b" />
        </Host>
    </Engine>
</Server>
